<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Listado de Asistentes - Congreso</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase -->
  <script type="module">
    // ---------------------------
    // IMPORTAR FIREBASE SDKs
    // ---------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot, deleteDoc, doc, updateDoc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // --------------------------------------------------
    // 🔧 CONFIGURACIÓN DE TU PROYECTO FIREBASE 
    // --------------------------------------------------
   const firebaseConfig = {
  apiKey: "AIzaSyArXBCsTBrtvPFV-OpcFvvKJLrLO6y5dSQ",
  authDomain: "mujeres-af-25.firebaseapp.com",
  projectId: "mujeres-af-25",
  storageBucket: "mujeres-af-25.firebasestorage.app",
  messagingSenderId: "694350834729",
  appId: "1:694350834729:web:93875951d702c5b75f0038",
  measurementId: "G-7BFJ2R1NTQ"
    };

    // Inicializamos Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Referencia a la colección de asistentes
    const asistentesRef = collection(db, "asistentes");

    // ---------------------------
    // 🔹 FUNCIONES
    // ---------------------------

    const form = document.getElementById("asistenteForm");
    const tabla = document.getElementById("tablaAsistentes");

    // Añadir un nuevo asistente
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nuevo = {
        nombre: form.nombre.value,
        telefono: form.telefono.value,
        abono: form.abono.value,
        coche: form.coche.value,
        acompanante: form.acompanante.value,
        timestamp: Date.now()
      };
      await addDoc(asistentesRef, nuevo);
      form.reset();
    });

    // Mostrar asistentes en tiempo real
    onSnapshot(asistentesRef, (snapshot) => {
      tabla.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const a = docSnap.data();
        const id = docSnap.id;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="p-3 border-b"><input class="bg-transparent w-full" value="${a.nombre || ''}" onchange="editarCampo('${id}', 'nombre', this.value)"></td>
          <td class="p-3 border-b"><input class="bg-transparent w-full" value="${a.telefono || ''}" onchange="editarCampo('${id}', 'telefono', this.value)"></td>
          <td class="p-3 border-b"><input class="bg-transparent w-full" value="${a.abono || ''}" onchange="editarCampo('${id}', 'abono', this.value)"></td>
          <td class="p-3 border-b"><input class="bg-transparent w-full" value="${a.coche || ''}" onchange="editarCampo('${id}', 'coche', this.value)"></td>
          <td class="p-3 border-b"><input class="bg-transparent w-full" value="${a.acompanante || ''}" onchange="editarCampo('${id}', 'acompanante', this.value)"></td>
          <td class="p-3 border-b text-center">
            <button onclick="borrarAsistente('${id}')" class="text-red-500 hover:text-red-700">🗑️</button>
          </td>
        `;
        tabla.appendChild(row);
      });
    });

    // Borrar asistente
    window.borrarAsistente = async (id) => {
      await deleteDoc(doc(db, "asistentes", id));
    };

    // Editar campo
    window.editarCampo = async (id, campo, valor) => {
      const ref = doc(db, "asistentes", id);
      await updateDoc(ref, { [campo]: valor });
    };
  </script>
    <!-- Librería para generar Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Librería para generar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
  // Botones de exportación
  const exportExcelBtn = document.getElementById('export-excel');
  const exportPdfBtn = document.getElementById('export-pdf');

  // Suponemos que tu tabla tiene id="asistentes-table"
  function obtenerDatosTabla() {
    const tabla = document.getElementById("tablaAsistentes");
    const filas = tabla.querySelectorAll("tr");
    const datos = [];

    filas.forEach(fila => {
      const celdas = fila.querySelectorAll("th, td");
      const filaDatos = [];
      celdas.forEach(celda => filaDatos.push(celda.innerText.trim()));
      datos.push(filaDatos);
    });

    return datos;
  }

  // 📊 Exportar a Excel
  exportExcelBtn.addEventListener("click", () => {
    const datos = obtenerDatosTabla();
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(datos);
    XLSX.utils.book_append_sheet(wb, ws, "Asistentes");
    XLSX.writeFile(wb, "lista_asistentes.xlsx");
  });

  // 📄 Exportar a PDF
  exportPdfBtn.addEventListener("click", async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const datos = obtenerDatosTabla();

    // Configuración básica del PDF
    let y = 10;
    datos.forEach((fila, i) => {
      doc.text(fila.join(" | "), 10, y);
      y += 10;
      if (y > 280) { doc.addPage(); y = 10; }
    });

    doc.save("lista_asistentes.pdf");
  });
</script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center py-10">
  <h1 class="text-3xl font-semibold mb-6 text-gray-800">📋 Lista de Asistentes Congreso</h1>

  <!-- Formulario -->
  <form id="asistenteForm" class="bg-white shadow-md rounded-2xl p-6 w-full max-w-2xl mb-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input id="nombre" name="nombre" type="text" placeholder="Nombre" required class="border rounded-lg p-2 w-full">
      <input id="telefono" name="telefono" type="text" placeholder="Teléfono" required class="border rounded-lg p-2 w-full">
      <input id="abono" name="abono" type="number" placeholder="Abono (Ej: VIP, General...)" class="border rounded-lg p-2 w-full">
      <input id="coche" name="coche" type="text" placeholder="Coche (Ej: Sí / Matrícula)" class="border rounded-lg p-2 w-full">
      <input id="acompanante" name="acompanante" type="text" placeholder="Acompañante" class="border rounded-lg p-2 w-full">
    </div>
    <button type="submit" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">
      Añadir Asistente
    </button>
  </form>

  <!-- Tabla -->
  <div class="bg-white shadow-md rounded-2xl p-6 w-full max-w-5xl">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-gray-100 text-gray-700 text-left">
          <th class="p-3 border-b">Nombre</th>
          <th class="p-3 border-b">Teléfono</th>
          <th class="p-3 border-b">Abono</th>
          <th class="p-3 border-b">Coche</th>
          <th class="p-3 border-b">Acompañante</th>
          <th class="p-3 border-b text-center">Acciones</th>
        </tr>
      </thead>
      <tbody id="tablaAsistentes" class="text-gray-800"></tbody>
    </table>
  </div>
  <!-- PDF ó EXCEL -->
  <div class="flex justify-end gap-3 mb-4">
  <button id="export-excel" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
    📊 Exportar a Excel
  </button>
  <button id="export-pdf" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">
    📄 Exportar a PDF
  </button>
</div>

</body>
</html>
